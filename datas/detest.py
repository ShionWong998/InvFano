import torch
import torch.nn as nn
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from torch.utils.data import Dataset, DataLoader
import pickle

device = torch.device("cuda" if torch.cuda.is_available() else "cpu")

class FowardSet(Dataset):
    def __init__(self, csv_file):
        self.data = pd.read_csv(csv_file)
        self.inputs = self.data.iloc[:, :6].values
        self.outputs = self.data.iloc[:, 6:].values
    def __len__(self):
        return len(self.inputs)
    def __getitem__(self,index):
        input_data = torch.tensor(self.inputs[index], dtype=torch.float32)
        output_data = torch.tensor(self.outputs[index], dtype=torch.float32)
        return input_data, output_data

class FowardNet(nn.Module):
    def __init__(self):
        super(FowardNet, self).__init__()
        self.hidden_layers = nn.ModuleList()
        self.hidden_layers.append(nn.Linear(6, 400))
        self.hidden_layers.append(nn.Linear(400, 600))
        for _ in range(3):
            self.hidden_layers.append(nn.Linear(600,600))
        self.hidden_layers.append(nn.Linear(600, 400))
        self.hidden_layers.append(nn.Linear(400, 201))

        self.output_layer = nn.Linear(201,201)

        self.LR = nn.LeakyReLU()
        self.relu = nn.ReLU()
        #self.sigmoid = nn.Sigmoid()


    def forward(self, x):
        for layer in self.hidden_layers:
            x = self.relu(layer(x))

        x = self.relu(self.output_layer(x))

        return x

    def initialize(self):
        for m in self.modules():
            if isinstance(m, nn.Linear):
                nn.init.kaiming_normal_(m.weight.data)
                if m.bias is not None:
                    nn.init.kaiming_normal_(m.bias.data)



fnpath = 'fn.pt'
net = torch.load(fnpath)
net.to(device)




#target = np.array([0.58667,0.59228,0.59797,0.60374,0.60958,0.61551,0.62151,0.62759,0.63374,0.63996,0.64626,0.65263,0.65907,0.66557,0.67214,0.67877,0.68547,0.69222,0.69902,0.70588,0.71278,0.71973,0.72671,0.73374,0.74079,0.74787,0.75498,0.7621,0.76923,0.77636,0.7835,0.79062,0.79774,0.80483,0.81189,0.81891,0.8259,0.83283,0.8397,0.8465,0.85322,0.85986,0.8664,0.87283,0.87915,0.88535,0.89141,0.89733,0.9031,0.9087,0.91414,0.91939,0.92445,0.92931,0.93396,0.9384,0.94261,0.94659,0.95032,0.95381,0.95705,0.96003,0.96274,0.96518,0.96736,0.96925,0.97087,0.97221,0.97326,0.97352,0.97456,0.9748,0.97477,0.97446,0.9739,0.97309,0.97204,0.97076,0.96926,0.96755,0.96566,0.96359,0.96137,0.95903,0.95659,0.95408,0.95153,0.949,0.94651,0.94413,0.94192,0.93996,0.93834,0.93718,0.9366,0.93662,0.93662,0.93621,0.94067,0.94447,0.94692,0.94218,0.90934,0.77755,0.41805,0.0443,0.08003,0.24802,0.36905,0.44461,0.49227,0.52314,0.5435,0.55696,0.56569,0.57107,0.574,0.57509,0.57476,0.57334,0.57104,0.56803,0.56446,0.56043,0.55601,0.55126,0.54625,0.54101,0.53557,0.52996,0.5242,0.51832,0.51232,0.5062,0.49999,0.49367,0.48726,0.48074,0.47412,0.46737,0.46049,0.45345,0.44624,0.43881,0.43114,0.42315,0.4148,0.40598,0.39654,0.38609,0.37634,0.36434,0.35061,0.33495,0.31651,0.29408,0.26575,0.22834,0.17663,0.10373,0.02142,0.14279,0.66455,0.7595,0.69264,0.63119,0.58628,0.55321,0.52798,0.50803,0.49176,0.47815,0.46652,0.45639,0.44745,0.43945,0.43221,0.42559,0.41945,0.41365,0.40778,0.39456,0.40189,0.39677,0.39251,0.38864,0.38503,0.38164,0.37845,0.37543,0.37257,0.36986,0.3673,0.36487,0.36257,0.3604,0.35834,0.3564,0.35458,0.35287,0.35128
#])
#target1 = np.array([0.52253,0.52605,0.52963,0.53327,0.53697,0.54074,0.54458,0.54848,0.55244,0.55647,0.56057,0.56474,0.56897,0.57328,0.57765,0.58209,0.5866,0.59117,0.59582,0.60054,0.60532,0.61018,0.6151,0.6201,0.62516,0.6303,0.6355,0.64077,0.6461,0.65151,0.65698,0.66251,0.66812,0.67378,0.67951,0.68529,0.69114,0.69705,0.70301,0.70903,0.71509,0.72121,0.72738,0.73359,0.73985,0.74614,0.75248,0.75884,0.76523,0.77166,0.7781,0.78456,0.79103,0.79752,0.804,0.81049,0.81697,0.82344,0.82989,0.83632,0.84272,0.84908,0.8554,0.86168,0.86789,0.87405,0.88013,0.88613,0.89205,0.89788,0.9036,0.90922,0.91472,0.92009,0.92534,0.93044,0.93539,0.94019,0.94483,0.94929,0.95358,0.95768,0.96158,0.96529,0.96879,0.97207,0.97509,0.97743,0.98087,0.9832,0.98535,0.98728,0.98898,0.99044,0.99166,0.99265,0.9934,0.99391,0.99418,0.99423,0.99405,0.99365,0.99303,0.99221,0.99118,0.98996,0.98856,0.98699,0.98526,0.98339,0.98139,0.97927,0.97706,0.97477,0.97243,0.97006,0.96768,0.96533,0.96302,0.9608,0.9587,0.95676,0.95502,0.95354,0.95236,0.95155,0.95117,0.9513,0.95201,0.95339,0.95552,0.95847,0.96231,0.96705,0.97259,0.97861,0.98441,0.98845,0.98762,0.97586,0.94187,0.86691,0.72802,0.5187,0.28247,0.10006,0.01466,0.00671,0.03765,0.08093,0.12394,0.16206,0.19422,0.22069,0.24219,0.25948,0.27324,0.28403,0.29311,0.29888,0.30339,0.3064,0.30809,0.30863,0.30814,0.30671,0.30441,0.3013,0.29741,0.29276,0.28735,0.28115,0.27413,0.26623,0.25736,0.2474,0.23621,0.22357,0.20924,0.19286,0.174,0.15209,0.12622,0.1083,0.06581,0.03029,0.00313,0.01755,0.1618,0.52067,0.87103,0.96007,0.90299,0.82029,0.74732,0.68858,0.64186,0.60432,0.57364,0.54812,0.52653
#    ])



#inp = np.array([8.415,4.331,74.819,23.048,0.554,0.023])
#inp1 = np.array([8.857,8.302,25.963,73.240,0.597,0.013])
L = np.array([3,3,10,10,0.262,0.01])
U = np.array([12,12,100,100,0.785,0.3])
#inp = np.array([6.92846,8.94307,10.0,66.74830,0.64505,0.03506])
inp = np.genfromtxt('outout1.csv', delimiter=',')
inpn = (inp - L) / (U - L)
tt = torch.tensor(inpn, dtype=torch.float32).to(device)

outout = net(tt)
out_np = outout.cpu().detach().numpy()

#target = np.genfromtxt('rest1.csv',delimiter=',')
#aaa = np.
np.savetxt('abc.csv', out_np, delimiter=',', newline='\n', fmt='%.5f')

#print(out_np)

#xx = np.linspace(3,5,201)
#fig, ax = plt.subplots()
#ax.plot(xx, out_np)
#ax.plot(xx, target[0])
#ax.plot(xx, out_np[1])
#ax.plot(xx, target[1])
#ax.plot(xx, out_np[2])
#ax.plot(xx, target[2])
plt.show()